<div class="certificates-container">
  <div class="certificates-header">
    <div class="header-content">
      <h1>
        <svg width="32" height="32" viewBox="0 0 24 24" fill="none" class="header-icon">
          <path d="M9 12L11 14L15 10M20 6V5C20 3.89543 19.1046 3 18 3H6C4.89543 3 4 3.89543 4 5V19C4 20.1046 4.89543 21 6 21H18C19.1046 21 20 20.1046 20 19V18M20 10V14M20 10H12.5M20 14H12.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        Mis Certificados
      </h1>
      <p>Gestiona y descarga tus certificados de formación médica</p>
    </div>
    <div class="stats-row">
      <div class="stat-card">
        <div class="stat-value">{{ certificates.length }}</div>
        <div class="stat-label">Total</div>
      </div>
      <div class="stat-card issued">
        <div class="stat-value">{{ getStatusCount('issued') }}</div>
        <div class="stat-label">Emitidos</div>
      </div>
      <div class="stat-card pending">
        <div class="stat-value">{{ getStatusCount('pending') }}</div>
        <div class="stat-label">Pendientes</div>
      </div>
    </div>
  </div>

  <div class="certificates-layout">
    <div class="certificates-list-section">
      <div class="filters-section">
        <div class="filter-group">
          <button
            class="filter-chip"
            [class.active]="activeFilter === 'all'"
            (click)="setFilter('all')">
            <span class="chip-dot"></span>
            Todos
          </button>
          <button
            class="filter-chip"
            [class.active]="activeFilter === 'issued'"
            (click)="setFilter('issued')">
            <span class="chip-dot issued"></span>
            Emitidos
          </button>
          <button
            class="filter-chip"
            [class.active]="activeFilter === 'pending'"
            (click)="setFilter('pending')">
            <span class="chip-dot pending"></span>
            Pendientes
          </button>
        </div>

        <div class="search-row">
          <div class="search-box">
            <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
              <circle cx="9" cy="9" r="7" stroke="currentColor" stroke-width="1.5"/>
              <path d="M15 15l4 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
            </svg>
            <input
              type="text"
              placeholder="Buscar certificados..."
              [(ngModel)]="searchQuery">
          </div>

          <select
            class="category-select"
            [(ngModel)]="categoryFilter">
            <option value="all">Todas las categorías</option>
            <option *ngFor="let category of categories" [value]="category">
              {{category}}
            </option>
          </select>
        </div>
      </div>

      <div class="certificates-list">
        <div
          class="certificate-card"
          *ngFor="let certificate of filteredCertificates"
          [class.selected]="selectedCertificate?.id === certificate.id"
          [class.placeholder]="isPlaceholder(certificate)"
          (click)="selectCertificate(certificate)">

          <div class="card-status" [style.background]="getStatusColor(certificate.status)">
            <span class="status-dot"></span>
            {{ getStatusText(certificate.status) }}
          </div>

          <h3 class="card-title">{{ certificate.courseTitle }}</h3>

          <div class="card-info">
            <div class="info-row">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M8 8a3 3 0 100-6 3 3 0 000 6zM2 14c0-2.5 2.5-4 6-4s6 1.5 6 4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              <span>{{ certificate.instructor }}</span>
            </div>

            <div class="info-row">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <rect x="2" y="3" width="12" height="11" rx="2" stroke="currentColor" stroke-width="1.5"/>
                <path d="M2 6h12M5 1v3M11 1v3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              <span>{{ formatDate(certificate.issueDate) }}</span>
            </div>

            <div class="info-row">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <circle cx="8" cy="8" r="6" stroke="currentColor" stroke-width="1.5"/>
                <path d="M8 4v4l3 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              <span>{{ certificate.hoursCompleted }}h</span>
            </div>
          </div>

          <div class="card-meta">
            <span class="certificate-id">{{ certificate.certificateId }}</span>
            <span class="certificate-grade" *ngIf="certificate.grade && certificate.grade > 0">
              <svg width="14" height="14" viewBox="0 0 14 14" fill="none">
                <path d="M7 1l1.5 4.5h4.5l-3.5 2.5 1.5 4.5L7 10l-3.5 2.5 1.5-4.5-3.5-2.5h4.5L7 1z" fill="currentColor"/>
              </svg>
              {{ certificate.grade }}/100
            </span>
          </div>

          <div class="card-actions" *ngIf="canDownload(certificate)">
            <button
              class="btn-download"
              (click)="downloadCertificate(certificate); $event.stopPropagation()">
              <svg width="16" height="16" viewBox="0 0 16 16" fill="none">
                <path d="M8 11V1M8 11L5 8M8 11L11 8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M1 14h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              Descargar
            </button>
          </div>

          <div class="card-pending" *ngIf="isPlaceholder(certificate)">
            <span class="pending-badge">
              {{ getPlaceholderIcon(certificate) }} En proceso
            </span>
          </div>
        </div>

        <div class="empty-state" *ngIf="filteredCertificates.length === 0">
          <div class="empty-icon">
            <svg width="64" height="64" viewBox="0 0 64 64" fill="none">
              <rect x="12" y="8" width="40" height="48" rx="4" stroke="currentColor" stroke-width="2"/>
              <path d="M20 20h24M20 28h24M20 36h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            </svg>
          </div>
          <h3>No se encontraron certificados</h3>
          <p>No hay certificados que coincidan con tus filtros de búsqueda.</p>
          <button class="btn-clear" (click)="clearFilters()">
            Limpiar filtros
          </button>
        </div>
      </div>
    </div>

    <div class="certificate-preview-section">
      <div class="preview-container" *ngIf="selectedCertificate">
        <div class="preview-header">
          <div>
            <h2>{{ selectedCertificate.courseTitle }}</h2>
            <p>{{ selectedCertificate.certificateId }}</p>
          </div>
          <div class="preview-badge" [style.background]="getStatusColor(selectedCertificate.status)">
            {{ getStatusText(selectedCertificate.status) }}
          </div>
        </div>

        <div class="pdf-viewer">
          <!-- Previsualización del PDF con ng2-pdf-viewer -->
          <pdf-viewer
            *ngIf="currentPdfUrl && !isPlaceholder(selectedCertificate)"
            [src]="currentPdfUrl"
            [render-text]="true"
            [original-size]="false"
            [fit-to-page]="true"
            [zoom]="1"
            [show-all]="true"
            [stick-to-page]="true"
            style="width: 100%; height: 100%; display: block;">
          </pdf-viewer>

          <!-- Overlay para certificados pendientes -->
          <div class="pdf-overlay" *ngIf="isPlaceholder(selectedCertificate)">
            <div class="overlay-content">
              <div class="overlay-icon">
                <svg width="80" height="80" viewBox="0 0 80 80" fill="none">
                  <circle cx="40" cy="40" r="38" stroke="currentColor" stroke-width="2" stroke-dasharray="8 8"/>
                  <path d="M40 20v20m0 0v20m0-20h20m-20 0H20" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                </svg>
              </div>
              <h3>Certificado en Proceso</h3>
              <p>Este certificado está siendo preparado y estará disponible próximamente.</p>
            </div>
          </div>
        </div>

        <div class="certificate-details">
          <div class="detail-grid">
            <div class="detail-item">
              <div class="detail-icon">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path d="M10 10a4 4 0 100-8 4 4 0 000 8zM3 18c0-3 3-5 7-5s7 2 7 5" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </div>
              <div>
                <div class="detail-label">Instructor</div>
                <div class="detail-value">{{ selectedCertificate.instructor }}</div>
              </div>
            </div>

            <div class="detail-item">
              <div class="detail-icon">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <rect x="3" y="4" width="14" height="13" rx="2" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M3 7h14M6 2v3M14 2v3" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </div>
              <div>
                <div class="detail-label">Fecha de Emisión</div>
                <div class="detail-value">{{ formatDate(selectedCertificate.issueDate) }}</div>
              </div>
            </div>

            <div class="detail-item" *ngIf="selectedCertificate.grade && selectedCertificate.grade > 0">
              <div class="detail-icon grade">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path d="M10 2l2 6h6l-5 4 2 6-5-4-5 4 2-6-5-4h6l2-6z" fill="currentColor"/>
                </svg>
              </div>
              <div>
                <div class="detail-label">Calificación Final</div>
                <div class="detail-value grade">{{ selectedCertificate.grade }}/100</div>
              </div>
            </div>

            <div class="detail-item">
              <div class="detail-icon">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <circle cx="10" cy="10" r="7" stroke="currentColor" stroke-width="1.5"/>
                  <path d="M10 6v4l3 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </div>
              <div>
                <div class="detail-label">Horas de Formación</div>
                <div class="detail-value">{{ selectedCertificate.hoursCompleted }} horas</div>
              </div>
            </div>

            <div class="detail-item" *ngIf="selectedCertificate.validityPeriod">
              <div class="detail-icon">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path d="M10 2a8 8 0 100 16 8 8 0 000-16zM10 6v4l3 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </div>
              <div>
                <div class="detail-label">Validez</div>
                <div class="detail-value">{{ selectedCertificate.validityPeriod }}</div>
              </div>
            </div>

            <div class="detail-item">
              <div class="detail-icon">
                <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                  <path d="M4 6h12M4 10h12M4 14h8" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                </svg>
              </div>
              <div>
                <div class="detail-label">Categoría</div>
                <div class="detail-value">{{ selectedCertificate.courseCategory }}</div>
              </div>
            </div>
          </div>
        </div>

        <div class="preview-actions">
          <div class="actions-grid" *ngIf="canDownload(selectedCertificate)">
            <button class="btn-action primary" (click)="downloadCertificate(selectedCertificate)">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <path d="M10 13V3M10 13L7 10M10 13L13 10" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
                <path d="M3 16h14" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              Descargar PDF
            </button>

            <button class="btn-action secondary" (click)="shareCertificate(selectedCertificate)">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <circle cx="15" cy="5" r="3" stroke="currentColor" stroke-width="1.5"/>
                <circle cx="5" cy="10" r="3" stroke="currentColor" stroke-width="1.5"/>
                <circle cx="15" cy="15" r="3" stroke="currentColor" stroke-width="1.5"/>
                <path d="M7.5 11.5l5 2M12.5 6.5l-5 2" stroke="currentColor" stroke-width="1.5"/>
              </svg>
              Compartir
            </button>

            <button class="btn-action linkedin" (click)="viewInLinkedIn(selectedCertificate)">
              <svg width="20" height="20" viewBox="0 0 20 20" fill="none">
                <rect x="2" y="2" width="16" height="16" rx="2" stroke="currentColor" stroke-width="1.5"/>
                <path d="M6 8v6M6 6v.5M10 14v-4c0-1.5 1-2 2-2s2 .5 2 2v4" stroke="currentColor" stroke-width="1.5" stroke-linecap="round"/>
              </svg>
              LinkedIn
            </button>
          </div>

          <div class="pending-notice" *ngIf="isPlaceholder(selectedCertificate)">
            <div class="notice-icon">{{ getPlaceholderIcon(selectedCertificate) }}</div>
            <div class="notice-content">
              <h3>Certificado en Proceso</h3>
              <p>Tu certificado está siendo preparado por nuestro equipo académico. Recibirás una notificación cuando esté disponible.</p>
            </div>
          </div>
        </div>
      </div>

      <div class="no-selection" *ngIf="!selectedCertificate">
        <div class="no-selection-icon">
          <svg width="120" height="120" viewBox="0 0 120 120" fill="none">
            <rect x="20" y="15" width="80" height="90" rx="4" stroke="currentColor" stroke-width="2" stroke-dasharray="8 8"/>
            <path d="M35 35h50M35 50h50M35 65h35" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </div>
        <h3>Selecciona un certificado</h3>
        <p>Selecciona un certificado de la lista para ver su vista previa y opciones de descarga.</p>
      </div>
    </div>
  </div>
</div>